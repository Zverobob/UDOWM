// Массивы данных для сборки лута
let rarity = ["Обычный", "Необычный", "Редкий", "Эпический", "Легендарный", "Мифический", "Уникальный"];
let prefix = ["Старый", "Магический", "Прочный", "Зачарованный", "Таинственный", "Древний","Сломанный", "Гнилой", "Кривой", "Странный", "Смешной", "Ужасный", "Вонючий","Скользкий", "Облезлый", "Ржавый", "Пьяный", "Ленивый", "Волшебный", "Неуклюжий","Сверхъестественный", "Космический", "Гигантский", "Миниатюрный", "Неуловимый","Неубиваемый", "Сверхскоростной", "Туманный", "Кровавый", "Ледяной", "Огненный","Ядовитый", "Электрический", "Светящийся", "Теневой", "Звёздный", "Лунный","Солнечный", "Песочный", "Каменный", "Деревянный", "Стеклянный", "Костяной", "Железный","Божественный", "Демонический", "Запретный", "Забытый", "Потерянный", "Найденный","Секретный", "Проклятый", "Благословлённый", "Освящённый", "Осквернённый"];
let suffix = ["огня", "льда", "молний", "тьмы", "света", "яда", "ветра", "земли", "вечной икоты", "случайных взрывов", "неудач", "постоянного зуда", "неконтролируемого смеха", "запаха тухлой рыбы", "самопроизвольного танца", "невидимости (но только для себя)", "призывания голубей", "случайных падений", "вечной сонливости", "неуместного каминг-аута", "потери носков", "притягивания грязи", "внезапного чихания", "появления радуги", "вечного голода", "случайных ожогов", "непредсказуемых прыжков", "постоянного шёпота", "неуместного свиста", "случайных объятий", "вечного дождя", "неожиданных комплиментов", "случайных пауз", "вечного эха", "неуместного смеха", "случайных падений с лестницы", "постоянного мерцания", "непредсказуемых изменений цвета", "случайных звуков флейты", "вечного запаха попкорна", "неуместного аплодисментов", "случайных вспышек света", "постоянного чувства дежавю", "непредсказуемых изменений размера", "случайных появлений бабочек", "вечного чувства голода", "неуместного кашля", "случайных падений в лужи", "постоянного шума ветра", "непредсказуемых изменений погоды", "случайных появлений радуги"];
let loot_type = ["Меч", "Щит", "Зелье", "Кольцо", "Амулет", "Доспех", "Лук", "Стрелы", "Посох", "Кинжал", "Арбалет", "Сапоги", "Перчатки", "Шлем", "Плащ"];
let unique = ["Носочный бумеранг", "Стримлерская Бандана", "Кринжал", "Бан-хаммер", "Ядерный Чемоданчик", "Байкальская Водица", "Боевой Бобёр", "Отрицательный IQ", "Волосы Стримера", "Самый Рофельный Мем", "Карманная Вселенная"];

// Роллим лут заранее, чтобы потом собрать предмет
let rr = 0;
let rp = prefix[prefix.length * Math.random() | 0]; 
let rs = suffix[suffix.length * Math.random() | 0]; 
let ln = loot_type.length * Math.random() | 0;
let rl = loot_type[ln];

// Весы для рандомизации лута
// Old weight = [80,60,30,20,10,5,1];
let weight = [40,50,30,20,10,5,2];
let max = 0;
let rez = 0;
for (let i = 0; i < weight.length; i++ ) {
  max += weight[i];
}

// Рандомизируем тип лута
lootQuality = Math.floor((Math.random() * max) + 1);
for (let i = 0; i < weight.length; i++){
  if ( lootQuality <= max ) {
    max -= weight[i];
    rez = i;
  }
}
rr = rarity[rez];

let item_gender = ["m","m","n","n","m","m","m","R","m","m","m","R","R","m","m"];
if (item_gender[ln] == "n"){
  if (rp.endsWith("ый") || rp.endsWith("ий") || rp.endsWith("ой")){
    rp = rp.slice(0, -2) + "ое";
  }
}
else if (item_gender[ln] == "w"){
  if (rp.endsWith("ый") || rp.endsWith("ий") || rp.endsWith("ой")){
    rp = rp.slice(0, -2) + "ая";
  }
}
else if (item_gender[ln] == "R"){
  if (rp.endsWith("ый") || rp.endsWith("ий")){
    rp = rp.slice(0, -1) + "e";
  }
  else if ( rp.endsWith("ой") ){
    rp = rp.slice(0, -2) + "ыe";
  }
  else if ( rp.endsWith("йся") ){
    rp = rp.slice(0, -2) + "еся";
  }
}

let end_quote = ``;
if (ul == "moderator" | ul == "owner" ){end_quote += `/announce `; }
else if (ul == "twitch_vip" ){end_quote += `Граф(иня) `; }
else if (ul == "subscriber" ){end_quote += `Воин `; }
end_quote += `${usr} вернулся из данжа! И принёс ${rr} Предмет: `;
if ( rez < 6){
    if (rez >= 1){
      end_quote += `${rp} `;
    }
    end_quote += `${rl}`;
    if (rez >= 3){
      end_quote += ` ${rs}`;
    }
}
else {
    end_quote += `${unique[unique.length * Math.random() | 0]} `;
    end_quote += ` ${rs}`;
}
end_quote += `!`;
`${end_quote}`;
